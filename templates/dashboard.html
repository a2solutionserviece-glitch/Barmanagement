{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}

<style>
/* ===== Modern Soft Theme ===== */

.dashboard-card {
    border-radius: 14px;
    padding: 22px;
    color: white;
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    transition: transform .2s;
}

.dashboard-card:hover {
    transform: translateY(-4px);
}

.card-sales {
    background: linear-gradient(135deg, #16a34a, #4ade80);
}

.card-orders {
    background: linear-gradient(135deg, #2563eb, #60a5fa);
}

.card-items {
    background: linear-gradient(135deg, #7c3aed, #c084fc);
}

.card-lowstock {
    background: linear-gradient(135deg, #dc2626, #f87171);
}

.section-card {
    background: white;
    border-radius: 14px;
    padding: 18px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

/* Table Styling */
.table-modern thead {
    background: #1e3a8a;
    color: white;
}

.table-modern tbody tr:nth-child(even) {
    background: #f1f5f9;
}

.table-modern tbody tr:hover {
    background: #e2e8f0;
}

/* Chart container */
.chart-box {
    background: white;
    border-radius: 14px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
</style>


<div class="container-fluid">

    <h2 class="mb-4">Dashboard</h2>

    <!-- TOP SUMMARY CARDS -->
    <div class="row mb-4">

    <div class="col-md-3">
        <div class="dashboard-card card-sales">
            <h6 class="fw-light">Today's Sales</h6>
            <h2 id="dash_sales" class="fw-bold mt-2">â‚¹0.00</h2>
        </div>
    </div>

    <div class="col-md-3">
        <div class="dashboard-card card-orders">
            <h6 class="fw-light">Today's Orders</h6>
            <h2 id="dash_orders" class="fw-bold mt-2">0</h2>
        </div>
    </div>

    <div class="col-md-3">
        <div class="dashboard-card card-items">
            <h6 class="fw-light">Items Sold Today</h6>
            <h2 id="dash_items" class="fw-bold mt-2">0</h2>
        </div>
    </div>

    <div class="col-md-3">
        <div class="dashboard-card card-lowstock">
            <h6 class="fw-light">Low Stock</h6>
            <h2 id="dash_lowstock" class="fw-bold mt-2">0</h2>
        </div>
    </div>

</div>


 <div class="chart-box mb-5">
    <h5 class="fw-bold mb-6">ðŸ“Š Last 7 Days Sales</h5>
    <canvas id="salesChart" height="70"></canvas>
</div>


    <!-- 3 COLUMN TABLES -->
    <div class="row">

        <!-- Low Stock Items -->
        <div class="col-md-4">
            <div class="card shadow-sm p-3 mb-4">
                <h6>Items Running Low</h6>
                <table class="table small table-striped">
                    <thead>
                        <tr><th>Item</th><th class="text-end">Qty</th></tr>
                    </thead>
                    <tbody id="tbl_lowstock">
                        <tr><td colspan="2" class="text-muted">Loadingâ€¦</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Top Selling Items -->
        <div class="col-md-4">
            <div class="card shadow-sm p-3 mb-4">
                <h6>Top Selling Items</h6>
                <table class="table small table-striped">
                    <thead>
                        <tr><th>Item</th><th class="text-end">Sold</th></tr>
                    </thead>
                    <tbody id="tbl_topselling">
                        <tr><td colspan="2" class="text-muted">Loadingâ€¦</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="col-md-4">
            <div class="card shadow-sm p-3 mb-4">
                <h6>Recent Orders</h6>
                <table class="table small table-striped">
                    <thead>
                        <tr><th>Order</th><th class="text-end">Amount</th></tr>
                    </thead>
                    <tbody id="tbl_recent">
                        <tr><td colspan="2" class="text-muted">Loadingâ€¦</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

</div>

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", loadDashboard);

async function loadDashboard() {
    const res = await fetch("/api/dashboard");
    const data = await res.json();

    // summary cards
    document.getElementById("dash_sales").innerText = "â‚¹" + data.today_sales.toFixed(2);
    document.getElementById("dash_orders").innerText = data.today_orders;
    document.getElementById("dash_items").innerText = data.today_items_sold;
    document.getElementById("dash_lowstock").innerText = data.low_stock_count;

    // 7 day chart
    new Chart(document.getElementById("salesChart"), {
        type: "bar",
        data: {
            labels: data.sales_7_days.labels,
            datasets: [{
                label: "Sales (â‚¹)",
                data: data.sales_7_days.values,
                backgroundColor: "#4e73df"
            }]
        }
    });

    // low stock table
    loadTable("tbl_lowstock", data.low_stock_list, ["item_name", "qty"]);

    // top selling
    loadTable("tbl_topselling", data.top_selling, ["item_name", "sold"]);

    // recent orders
    loadTable("tbl_recent", data.recent_orders, ["order_id", "amount"], true);
}

function loadTable(id, rows, keys, currency=false) {
    const tbody = document.getElementById(id);
    tbody.innerHTML = "";

    if (!rows.length) {
        tbody.innerHTML = `<tr><td colspan="2" class="text-muted">No data</td></tr>`;
        return;
    }

    rows.forEach(r => {
        tbody.innerHTML += `
            <tr>
                <td>${r[keys[0]]}</td>
                <td class="text-end">${currency ? "â‚¹" + r[keys[1]].toFixed(2) : r[keys[1]]}</td>
            </tr>`;
    });
}
</script>

{% endblock %}
