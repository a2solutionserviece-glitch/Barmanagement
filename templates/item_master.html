{% extends "base.html" %}
{% block title %}Item Master{% endblock %}
{% block content %}

<div class="container-box">
    <h2 class="mb-4">Item Master /आयटम स्क्रीन</h2>

    <!-- Add Item Button -->
    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addItemModal">
        + Add New Item /  नवीन आयटम तयार करा
    </button>

    <!-- ITEM LIST -->
    <div class="card card-box p-4">
        <div class="card-header bg-dark text-white rounded mb-3">
            <h4 class="m-0">Item List / वस्तू यादी</h4>
        </div>
<div class="row mb-3">
    <div class="col-md-4">
        <input type="text" id="searchInput" class="form-control" placeholder="Search items...">
    </div>
</div>

       <div style="max-height: 450px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px;">

    <table class="table table-hover table-bordered align-middle mt-0">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Category</th>
                <th>Selling Price</th>
                <th>Unit</th>
                <th>GST</th>
                <th>Stockable</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody id="itemTable">
            {% for item in items %}
            <tr>
                <td>{{ item[0] }}</td>
                <td>{{ item[1] }}</td>
                <td>{{ item[3] }}</td>
                <td>{{ item[6] }}</td>
                <td>{{ item[7] }}</td>
                <td>{{ item[8] }}%</td>
                <td>{% if item[9] %}<span class="badge bg-success">Yes</span>{% else %}<span class="badge bg-danger">No</span>{% endif %}</td>
                <td>{% if item[10] %}<span class="badge bg-success">Active</span>{% else %}<span class="badge bg-danger">Inactive</span>{% endif %}</td>
                <td>
                    <button type="button" class="btn btn-sm btn-info"
                        onclick='openEditModal({{ item | tojson }})'>
                        Edit
                    </button>
                   
                    <a href="/delete_item/{{ item[0] }}" class="btn btn-sm btn-danger"
                       onclick="return confirm('Delete item?')">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>

    </table>
</div>



        <!-- ADD ITEM MODAL -->
        <div class="modal fade" id="addItemModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">

                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">Add New Item</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <form method="POST" action="/add_item" class="row g-3">

                            <div class="col-md-4">
                                <label class="form-label">Item Name</label>
                                <input type="text" class="form-control" name="item_name" required>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Item Code</label>
                                <input type="text" class="form-control" name="item_code">
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Category</label>
                                <select class="form-select" name="category" required>
                                    <option value="">Select Category</option>
                                    <option value="Food">Food</option>
                                    <option value="Bar">Bar</option>
                                    <option value="Beverages">Beverages</option>
                                    <option value="Snacks">Snacks</option>
                                    <option value="Service">Service</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Purchase Price</label>
                                <input type="number" step="0.01" class="form-control" name="purchase_price" required>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Selling Price</label>
                                <input type="number" step="0.01" class="form-control" name="selling_price" required>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Unit</label>
                                <select class="form-select" name="unit" required>
                                    <option value="NOS">NOS</option>
                                    <option value="Bottle">Bottle</option>
                                    <option value="ML">ML</option>
                                    <option value="LTR">LTR</option>
                                    <option value="KG">KG</option>
                                    <option value="Plate">Plate</option>
                                </select>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">GST (%)</label>
                                <input type="number" type="number" step="0.01" min="0" max="100" class="form-control" name="gst_percentage">
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Stockable?</label>
                                <select class="form-select" name="stockable">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>

                            <div class="col-md-12">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" name="description" rows="2"></textarea>
                            </div>

                            <div class="col-md-3">
                                <button class="btn btn-primary w-100" type="submit">Save Item</button>
                            </div>

                        </form>
                    </div>

                </div>
            </div>
        </div> <!-- END ADD MODAL -->


        <!-- EDIT ITEM MODAL (Correct Position) -->
        <div class="modal fade" id="editItemModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">

                    <div class="modal-header bg-info text-white">
                        <h5 class="modal-title">Edit Item</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <form method="POST" action="/update_item" class="row g-3">

                            <input type="hidden" id="edit_item_id" name="item_id">

                            <div class="col-md-4">
                                <label class="form-label">Item Name</label>
                                <input type="text" class="form-control" id="edit_item_name" name="item_name" required>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Item Code</label>
                                <input type="text" class="form-control" id="edit_item_code" name="item_code">
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="edit_category" name="category" required>
                                    <option value="Food">Food</option>
                                    <option value="Bar">Bar</option>
                                    <option value="Beverages">Beverages</option>
                                    <option value="Snacks">Snacks</option>
                                    <option value="Service">Service</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Purchase Price</label>
                                <input type="number" step="0.01" class="form-control" id="edit_purchase_price" name="purchase_price">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Selling Price</label>
                                <input type="number" step="0.01" class="form-control" id="edit_selling_price" name="selling_price">
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Unit</label>
                                <select class="form-select" id="edit_unit" name="unit">
                                    <option value="NOS">NOS</option>
                                    <option value="Bottle">Bottle</option>
                                    <option value="ML">ML</option>
                                    <option value="LTR">LTR</option>
                                    <option value="KG">KG</option>
                                    <option value="Plate">Plate</option>
                                </select>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">GST (%)</label>
                                <input type="number" type="number" step="0.01" min="0" max="100" class="form-control" id="edit_gst" name="gst_percentage">
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Stockable?</label>
                                <select class="form-select" id="edit_stockable" name="stockable">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>

                            <div class="col-md-12">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" id="edit_description" name="description" rows="2"></textarea>
                            </div>

                            <div class="col-md-3">
                                <button class="btn btn-info w-100" type="submit">Update Item</button>
                            </div>

                        </form>
                    </div>

                </div>
            </div>
        </div>

    </div>
</div>


<!-- Edit Modal JS -->
<script>
function openEditModal(item) {
    document.getElementById('edit_item_id').value = item[0];
    document.getElementById('edit_item_name').value = item[1];
    document.getElementById('edit_item_code').value = item[2];
    document.getElementById('edit_category').value = item[3];
    document.getElementById('edit_description').value = item[4];
    document.getElementById('edit_purchase_price').value = item[5];
    document.getElementById('edit_selling_price').value = item[6];
    document.getElementById('edit_unit').value = item[7];
    document.getElementById('edit_gst').value = item[8];
    document.getElementById('edit_stockable').value = item[9] ? "true" : "false";

    let modal = new bootstrap.Modal(document.getElementById('editItemModal'));
    modal.show();
}
</script>

<script>
// Live Search Filter
document.getElementById("searchInput").addEventListener("keyup", function () {
    let input = this.value.toLowerCase();
    let rows = document.querySelectorAll("#itemTable tr");

    rows.forEach(row => {
        let text = row.innerText.toLowerCase();
        row.style.display = text.includes(input) ? "" : "none";
    });
});
</script>



{% endblock %}
